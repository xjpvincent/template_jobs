(function(e,t,s){if(typeof DoubanShare!=="undefined"){return}var l={},o=[],j="http://img3.douban.com/pics/loading.gif",f=".lnk-douban-sharing",d='<div id="dbshare-loading" style="position:absolute;left:50%;top:50%;margin:-20px 0 0 -25px;*margin-top:-40px;background:#fff;color:#333;line-height:1.2;font-size:14px;padding:0 10px;">加载中...</div>',g='<div style="padding:30px 0;text-align:center;font-size:14px;color:#060;">分享成功!</div>',n='<div class="rectitle"><span class="gact rr"><a href="#" class="lnk-close">x</a></span><span class="m" >{TITLE}</span></div><div class="bd" style="position:relative;line-height:0;font-size:0;"></div>',a=function(v,y,u){var x;if(/device-mobile/i.test(document.documentElement.className)){u=document.documentElement.clientWidth*0.9}if(typeof dui!=="undefined"&&dui.Dialog){x=dui.Dialog({width:u||500,content:v,title:y,isHideClose:0},true).open();x.node.addClass("dui-dialog-rec").find(".bd").css({position:"relative",padding:"10px 0 0 0","line-height":0,"font-size":0})}else{x=$("#dialog");if(x.length===0){$('<div id="overlay"></div><div id="dialog" class="dialog-shuo"  style="width:'+(u||500)+'px;"></div>').appendTo("body");x=$("#dialog")}x.html(v);h();x.find(".lnk-close").click(function(w){w.preventDefault();c()})}return x},h=function(){if(typeof dui!=="undefined"&&dui.Dialog&&l.currentDialog){l.currentDialog.update();return}var x=($.browser.msie)?-2:16,v=$("#dialog")[0],u=v.offsetWidth,y=(t.body.offsetWidth-u)/2;$("#overlay").css({height:v.offsetHeight+x,width:u+16,left:(y+5)+"px"});v.style.left=y+"px"},c=function(){if(typeof dui!=="undefined"&&dui.Dialog&&l.currentDialog){l.currentDialog.close();m.fire();return}$("#overlay, #dialog").remove();m.fire()},r=function(){o.push(1);return"db-sharing-iframe"+o.length},k=function(){var u=t.createElement("iframe");u.setAttribute("scrolling","no");u.setAttribute("frameBorder","0");u.setAttribute("width","100%");u.setAttribute("allowTransparency","true");u.src="";return u},b=function(C){var u=k(),x=r()+(+(new Date))+(0|Math.random()*1000000),w=C.css||"",B=C.text||"",A=C.heading||"推荐到豆瓣",z,v=(!C.image)?230:280,y=a(n.replace("{TITLE}",A),A,C.width);l.currentDialog=y;$(u).load(function(){try{u.setAttribute("height",u.contentWindow.document.body.clientHeight);h()}catch(D){}});u.setAttribute("id",x);u.setAttribute("height",C.height||v);u.src=s+$.param(C)+"&alt=xd&callback=DoubanShare.callback&_stamp="+x;if(y.node){y.node.find(".bd").css("background","url("+j+") 48% 48% no-repeat").eq(0).html("").append(u)}else{y.find(".bd").css("background","url("+j+") 48% 48% no-repeat").html("").append(u)}h()},m=function(u){m.callback.push(u)},q=function(u){b(u)},p=function(){$("html").delegate(f,"click",function(y){var w=$(y.currentTarget),v=w.data(),u=["user_id","object_kind","object_id"];y.preventDefault();for(i in v){if(typeof v[i]==="number"){v[i]=w.attr("data-"+i)}}reportDa={from:"snsrec2share"};for(i in u){var x=u[i];reportDa[x]=v[x]||0}moreurl&&moreurl(y.currentTarget,reportDa);b(v)})};m.callback=[];m.fire=function(){while(m.callback.length){(m.callback.pop())()}};p();l.cacheUrl={};l.updateDialog=function(u){var v=l.currentDialog;if(v.node){v.node.find("iframe").css("height",u+"px");v.update();return}if(u){$("#dialog iframe").css("height",u+"px")}h()};l.closeDialog=function(){var u=l.currentDialog;if(u.node){u.node.find(".hd").hide();u.node.find(".bd").css("background","none").html(g)}else{u.find(".rectitle").hide();u.find(".bd").css("background","none").html(g)}h();setTimeout(function(){c()},1000)};l.share=q;l.onDialogClose=m;e.DoubanShare=l;(new Image()).src=j})(window,document,rec_url);function exp_dialog(a){var b=document.documentElement;return 0-parseInt(a.offsetHeight/2)+(TBWindowMargin=b&&b.scrollTop||document.body.scrollTop)+"px"}function exp_overlay(a){return 0-parseInt(a.offsetHeight/2)+(TBWindowMargin=document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop)+"px"};